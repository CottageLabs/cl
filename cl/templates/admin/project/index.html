{% extends "base.html" %}

{% block subnav %}
    <div id="subnav" class="subnav">
        <div class="container">
            <ul class="nav nav-pills">
                <li><a href="/admin#dashboard">Dashboard</a></li>
                <li><a href="/admin#projects">Projects</a></li>
                <li><a href="/admin#financials">Financials</a></li>
                <li><a href="/admin#commitments">Commitments</a></li>
                <li><a href="/admin#contacts">Contacts</a></li>
                <li><a href="/admin#contractors">Contractors</a></li>
                <li><a href="/admin#reports">Reports</a></li>
                <li><a href="/media">Media</a></li>
                <li><a href="/sitemap">Sitemap</a></li>
                {% if current_user.is_super %}<li><a href="/account">Users</a></li>{% endif %}
            </ul>
        </div>
    </div>
{% endblock %}

{% block content %}

<script type="text/javascript" charset="utf-8">
jQuery(document).ready(function() {

    $('#creator').jtedit({
        'data':{}, 
        'makeform': false, 
        'actionbuttons': false,
        'jsonbutton': false,
        'target': '/record',
        'delmsg':"", 
        'savemsg':"", 
        "saveonupdate":false, 
        "reloadonsave":""
    });
    $('#jtedit_json').css({"width":"100%","min-height":"400px"}).toggle();
    var submitrecord = function(event) {
        event.preventDefault();
        // validate the supplied data
        $.fn.jtedit.saveit();
    };
    $('.submitrecord').bind('click',submitrecord);
    $('.jtedit_value').first().focus().blur();
    
    var addanother = function(event) {
        event.preventDefault();
        var current = parseInt($(this).attr('href'));
        var dp = $(this).attr('data-path').replace(current.toString(),(current+1).toString());
        var newlink = '<div><span class="upload_label"><a title="add another" class="addanother" data-path="' + dp + '" href="' + (current+1).toString() + '"> + </a> ' + $(this).parent().text().replace(' +','').replace((current+1).toString(),'') + ' ' + (current + 2).toString() + '</span> <input type="text" class="jtedit_value" data-path="' + dp + '" /></div>';
        $(this).parent().parent().after(newlink);
        $(this).remove();
        $('.addanother').unbind('click',addanother);
        $('.addanother').bind('click',addanother);
    };
    $('.addanother').bind('click',addanother);
    
    $('.notes-container').first().clone().insertAfter('#financials');
    $('.notes-container').first().clone().insertAfter('#projects');
    var notes = function() {
        $('.notes').hide();
        var show = $(this).attr('data-path');
        $('.' + show).show();
    };
    $('.jtedit_value').bind('focus',notes);
});
</script>            

<div class="row-fluid">
    <div class="span6">
    <div class="well">
                                        
        <div><span class="upload_label">title:</span> <input type="text" name="title" data-path="title" class="jtedit_value" /></div>

        <div><span class="upload_label">description:</span> <textarea name="description" data-path="description" class="jtedit_value"></textarea></div>

        <div><span class="upload_label">UNIQUE project ID tag:</span> <input type="text" name="id" data-path="id" class="jtedit_value" /></div>

        <div><span class="upload_label">other relevant tags:</span> <input type="text" name="tags" data-path="tags" class="jtedit_value" /></div>

        <div><span class="upload_label">proposer</span> 
            <select name="proposer" data-path="proposer" class="jtedit_value">
                <option></option>
                {% for name in dropdowns["clpeople"] %}
                <option>{{ name }}</option>
                {% endfor %}
            </select>
        </div>

        <div><span class="upload_label">senior +1</span> 
            <select name="plusone_0" data-path="plusone.0" class="jtedit_value">
                <option></option>
                {% for name in dropdowns["seniors"] %}
                <option>{{ name }}</option>
                {% endfor %}
            </select>
        </div>

        <div><span class="upload_label">additional +1</span> 
            <select name="plusone_1" data-path="plusone.1" class="jtedit_value">
                <option></option>
                {% for name in dropdowns["partners"] %}
                <option>{{ name }}</option>
                {% endfor %}
            </select>
        </div>

        <div><span class="upload_label">QC partner</span> 
            <select name="owner" data-path="owner" class="jtedit_value">
                <option></option>
                {% for name in dropdowns["partners"] %}
                <option>{{ name }}</option>
                {% endfor %}
            </select>
        </div>

        <div><span class="upload_label">project lead</span>
            <select name="lead" data-path="lead" class="jtedit_value">
                <option></option>
                {% for name in dropdowns["clpeople"] %}
                <option>{{ name }}</option>
                {% endfor %}
            </select>
        </div>

        <div><span class="upload_label">related projects:</span>
            <select name="parent" data-path="parent" class="jtedit_value">
                <option></option>
                {% for name in dropdowns["projects"] %}
                <option>{{ name }}</option>
                {% endfor %}
            </select>
        </div>

        <div><span class="upload_label">project docs folder URL:</span> <input type="text" name="folder" data-path="folder" class="jtedit_value" /></div>

        <div><span class="upload_label">project page URL:</span> <input type="text" name="page" data-path="page" class="jtedit_value" /> create? <input type="checkbox" name="createpage" /></div>

        <div><span class="upload_label">start date:</span> <input type="text" name="start" data-path="start" class="jtedit_value datepicker" /></div>

        <div><span class="upload_label">end date:</span> <input type="text" name="end" data-path="end" class="jtedit_value datepicker" /></div>

        <div><span class="upload_label">status:</span> 
            <select name="status" data-path="status" class="jtedit_value">
                <option>draft</option>
                <option>proposed</option>
                <option>rejected</option>
                <option>accepted</option>
                <option>current</option>
                <option>late</option>
                <option>complete</option>
            </select>
        </div>

        <div><span class="upload_label">further notes:</span> <input type="text" name="notes" data-path="notes" class="jtedit_value" /></div>

        <hr></hr>
        
        <div><span class="upload_label">external participants:</span> <input type="text" name="externals" data-path="externals" class="jtedit_value" /></div>

        <div><span class="upload_label">customer:</span> 
            <select name="customer" data-path="customer" class="jtedit_value">
                <option></option>
                {% for name in dropdowns["customers"] %}
                <option value="{{ name[0] }}">{{ name[1] }}</option>
                {% endfor %}
            </select>
        </div>

        <div><span class="upload_label">funder:</span> 
            <select name="funder" data-path="funder" class="jtedit_value">
                <option></option>
                {% for name in dropdowns["customers"] %}
                <option value="{{ name[0] }}">{{ name[1] }}</option>
                {% endfor %}
            </select>
        </div>

        <div><span class="upload_label">Total budget ex VAT:</span> <input type="text" name="budget" data-path="budget" class="jtedit_value" /></div>

        <div><span class="upload_label">Total expenses budget:</span> <input type="text" name="expenses" data-path="expenses" class="jtedit_value" /></div>

    </div>
    </div>
    
    <div class="span6">
        <div class="well notes-container">
            <p class="notes title">I am about the title.</p>
        </div>
        <div class="well">
            <p>You can directly edit the JSON for more control.</p>
            <div id="creator" class="clearfix"></div>
            <p><input class="btn btn-primary submitrecord" type="submit" name="submit" value="create record" /></p>
        </div>
    </div>
    
</div>

<div class="row-fluid">
    <div class="span12">
        <h3>Project team commitment</h3>
        <table id="projects" class="table table-striped table-bordered table-condensed">
            <tr>
                <td></td><td>Who</td><td>Date from</td><td>Date to</td><td>% time</td><td>% partner share</td>
            </tr>
            <tr>
                <td><a class="addanother" data-path="commitments" href="0"> + </a></td>
                <td>
                    <select name="commitments.0.who" data-path="commitments.0.who" class="jtedit_value" style="width:100px;">
                        <option></option>
                        {% for name in dropdowns["clpeople"] %}
                        <option {% if name in dropdowns["partners"] %}class="partner"{% endif %}>{{ name }}</option>
                        {% endfor %}
                    </select>
                </td>
                <td><input type="text" name="commitments.0.datefrom" data-path="commitments.0.datefrom" class="jtedit_value datepicker" style="width:100px;" /></td>
                <td><input type="text" name="commitments.0.dateto" data-path="commitments.0.dateto" class="jtedit_value datepicker" style="width:100px;" /></td>
                <td><input type="text" name="commitments.0.time" data-path="commitments.0.time" class="jtedit_value" style="width:100px;" /></td>
                <td><input type="text" name="commitments.0.share" data-path="commitments.0.share" class="jtedit_value" disabled style="width:100px;" /></td>
            </tr>
        </table>
    </div>
</div>

<div class="row-fluid">
    <div class="span12">
        <h3>Financial events</h3>
        <table id="financials" class="table table-striped table-bordered table-condensed">
            <tr>
                <td></td><td>Date</td><td>Event type</td><td>Ref</td><td>From / to</td><td>Description</td><td>Transaction ref.</td><td>£ + / - ex VAT</td><td>VAT</td>
            </tr>
            <tr>
                <td><a class="addanother" data-path="finance" href="0"> + </a></td>
                <td><input type="text" name="finance" data-path="finance.0.date" class="jtedit_value datepicker" style="width:80px;" /></td>
                <td>
                    <select name="finance" data-path="finance.0.type" class="jtedit_value" style="width:80px;">
                        <option></option>
                        {% for item in dropdowns["events"] %}
                        <option>{{ item }}</option>
                        {% endfor %}
                    </select>
                </td>
                <td><input type="text" name="finance" data-path="finance.0.ref" class="jtedit_value" style="width:80px;" /></td>
                <td>
                    <select name="finance" data-path="finance.0.fromto" class="jtedit_value" style="width:80px;">
                        <option></option>
                    </select>
                </td>
                <td><textarea name="finance" data-path="finance.0.description" class="jtedit_value" style="width:160px;"></textarea></td>
                <td><input type="text" name="finance" data-path="finance.0.transaction" class="jtedit_value" style="width:80px;" disabled /></td>
                <td><input type="text" name="finance" data-path="finance.0.cost" class="jtedit_value" style="width:80px;" disabled /></td>
                <td><input type="text" name="finance" data-path="finance.0.vat" class="jtedit_value" style="width:80px;" disabled /></td>
            </tr>
        </table>
    </div>
</div>


{% endblock %}

